(window["webpackJsonpsonar-app"]=window["webpackJsonpsonar-app"]||[]).push([[0],{100:function(e,t,a){},110:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(16),c=a(28),i=a(73),l=a(17),s=a(41),u=(a(91),a(93),a(82));s.initializeApp({apiKey:"AIzaSyCUu8zzfotKZNvfQcXRQm2LMX7xwMRCyRg",authDomain:"sonar-2664d.firebaseapp.com",databaseURL:"https://sonar-2664d.firebaseio.com",projectId:"sonar-2664d",storageBucket:"sonar-2664d.appspot.com",messagingSenderId:"85025589952",appId:"1:85025589952:web:772471903454f716"});var m=s.auth(),p=s.firestore(),d=u.a(s),h="GET_USER",f="GET_USER_INFO";function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(a,!0).forEach(function(t){Object(l.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(a,!0).forEach(function(t){Object(l.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var v=Object(c.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case h:return b({UID:n},e);case f:return b({},e,{},n);default:return e}},match:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"CREATED_MATCH":case"JOINED_MATCH":return E({},e,{id:n});case"GET_MATCH":return E({},e,{},n);case"PLAY_GAME":return E({},e,{inGame:!0});default:return e}},matches:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"GET_MATCHES":return n?Object.values(n):null;case"GOT_NO_MATCHES":return null;default:return e}}}),O=a(14),w=(a(100),a(124)),j=a(81),S=a.n(j),C=a(25),I=a(29),D=a(18),P=a(19),M=a(21),k=a(20),U=a(22),A=a(126),T=a(121),_=a(123),x=a(122),z=a(125),L=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(M.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={username:"",email:"",password:""},a.handleChange=function(e){a.setState(Object(l.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){e.preventDefault(),a.props.dispatch(function(e){var t=e.username,a=e.email,n=e.password;return function(e){return m.createUserWithEmailAndPassword(a,n).then(function(e){var a=e.user;return null!==a&&p.collection("users").doc(a.uid).set({username:t}).then(function(){console.log("user account created")}).catch(function(e){console.error("Error creating account: ",e)}),a}).then(function(t){e({type:h,payload:t.uid})}).catch(function(e){return console.log(e)})}}(a.state))},a}return Object(U.a)(t,e),Object(P.a)(t,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password,n=e.username;return null!==this.props.authed?r.a.createElement(I.a,{to:"/profile"}):r.a.createElement(A.a,{align:"center",pad:"large"},r.a.createElement("h2",null,"Welcome to sonar"),r.a.createElement(A.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large"},r.a.createElement(T.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(_.a,null,r.a.createElement(x.a,{placeholder:"email",name:"email",onChange:this.handleChange,value:t})),r.a.createElement(_.a,{required:!0},r.a.createElement(x.a,{placeholder:"user name",name:"username",value:n,onChange:this.handleChange})),r.a.createElement(_.a,null,r.a.createElement(x.a,{placeholder:"password",type:"password",name:"password",onChange:this.handleChange,value:a})),r.a.createElement(A.a,{direction:"row",justify:"center",margin:{top:"large"}},r.a.createElement(z.a,{type:"submit",primary:!0,label:"Sign up"}))),r.a.createElement(A.a,{direction:"row",justify:"center"},r.a.createElement("p",null,"Already have an account? ",r.a.createElement(C.b,{to:"/login"},"Login here")))))}}]),t}(n.Component),G=Object(O.b)(function(e){return{authed:e.user}})(L),R=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(M.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:""},a.handleChange=function(e){a.setState(Object(l.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){var t;e.preventDefault(),a.props.dispatch((t=a.state,function(e){return m.signInWithEmailAndPassword(t.email,t.password).then(function(t){var a=t.user;e({type:h,payload:a.uid})}).catch(function(e){return console.log(e)})}))},a}return Object(U.a)(t,e),Object(P.a)(t,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password;return null!==this.props.user?r.a.createElement(I.a,{to:"/profile"}):r.a.createElement(A.a,{align:"center",pad:"large"},r.a.createElement("h2",null,"Welcome to sonar"),r.a.createElement(A.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large"},r.a.createElement(T.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(_.a,null,r.a.createElement(x.a,{placeholder:"email",name:"email",onChange:this.handleChange,value:t})),r.a.createElement(_.a,null,r.a.createElement(x.a,{placeholder:"password",type:"password",name:"password",onChange:this.handleChange,value:a})),r.a.createElement(A.a,{direction:"row",justify:"center",margin:{top:"large"}},r.a.createElement(z.a,{type:"submit",primary:!0,label:"Login"}))),r.a.createElement(A.a,{direction:"row",justify:"center"},r.a.createElement("p",null,"Dont have an account yet? ",r.a.createElement(C.b,{to:"/SignUp"},"Sign Up here")))))}}]),t}(n.Component),W=Object(O.b)(function(e){return{user:e.user}})(R),N=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(M.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(U.a)(t,e),Object(P.a)(t,[{key:"componentDidMount",value:function(){var e;this.props.dispatch((e=this.props.user.UID,function(t){p.collection("users").doc(e).get().then(function(e){e.exists?t({type:f,payload:e.data()}):console.log("user not found")}).catch(function(e){console.log("Error getting user:",e)})}))}},{key:"render",value:function(){var e=this.props.user.username;return r.a.createElement(A.a,{align:"center"},r.a.createElement(A.a,null,r.a.createElement("h3",null," ",e," ")),r.a.createElement(z.a,{as:C.b,to:"/lobby",primary:!0,label:"play"}))}}]),t}(n.Component),H=Object(O.b)(function(e){return{user:e.user}})(N),J=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(M.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={name:"",password:"",redirect:!1,matches:[],matchId:!1},a.getMatches=function(e){p.collection("matches").onSnapshot(function(t){var n=[];t.forEach(function(t){var r=[];t.ref.collection("players").get().then(function(n){n.forEach(function(n){n.data().id===e&&a.setState({matchId:t.ref.id}),r.push(n.data())})}),n.push({matchId:t.ref.id,admin:t.data().admin,players:r})}),a.setState({matches:n})})},a.createMatch=function(e,t){p.collection("matches").add({admin:{id:e,name:t},name:a.state.name,password:a.state.password}).then(function(n){p.collection("matches").doc(n.id).collection("players").add({id:e,name:t}).then(function(){return a.setState({matchId:n.id})}).catch(function(e){return console.log("Error adding ".concat(t," to match. ").concat(e))})}).catch(function(e){return console.error("Error setting ".concat(t," as admin of match. ").concat(e))})},a.joinMatch=function(e,t,n){p.collection("matches").doc(e).collection("players").add({id:t,name:n}).then(function(){return a.setState({joined:!0})}).catch(function(e){return console.log("Error joining match. ".concat(e))})},a.handleInput=function(e){return a.setState(Object(l.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){e.preventDefault(),a.createMatch(a.props.user.UID,a.props.user.username)},a}return Object(U.a)(t,e),Object(P.a)(t,[{key:"componentDidMount",value:function(){this.props.user.UID&&this.getMatches(this.props.user.UID)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.user,a=t.UID,n=t.username,o=this.state,c=o.matches,i=o.matchId;return i?r.a.createElement(I.a,{to:"game/".concat(i)}):r.a.createElement(A.a,{direction:"column",justify:"center",align:"center",pad:"xlarge",gap:"large"},r.a.createElement("h1",null,"Create a game"),r.a.createElement(A.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large",width:"medium",align:"center"},r.a.createElement(T.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(_.a,{name:"name",label:"Match name",onChange:this.handleInput}),r.a.createElement(_.a,{type:"password",name:"password",label:"password",onChange:this.handleInput}),r.a.createElement(z.a,{type:"submit",primary:!0,label:"Create game"}))),r.a.createElement(A.a,{width:"medium",align:"center"},r.a.createElement("h1",null,"Join a game"),c&&c.map(function(t){return r.a.createElement(A.a,{key:t.matchId,pad:"small",border:{color:"primary",size:"large"},elevation:"small",round:"large",width:"medium",align:"center",direction:"row-responsive",style:{marginTop:"1.5em"}},r.a.createElement("h3",{style:{margin:"auto"}},t.name," ",r.a.createElement("br",null),"created by "+t.admin.name," ",r.a.createElement("br",null),t.players.length+" players joined"),r.a.createElement(z.a,{onClick:function(){return e.joinMatch(t.matchId,a,n)},primary:!0,label:"Join"}))})))}}]),t}(n.Component),V=Object(O.b)(function(e){return{user:e.user}})(J),X=a(35),Z=a.n(X),B=(a(106),null),F=function(e){function t(){var e,a;Object(D.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(M.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={boundary:{lat:-39.637652,lng:176.860973},position:null,zoom:18,admin:!1,initialising:!1,players:null,userLocationFound:!1},a.getPlayers=function(){p.collection(a.props.matchId).onSnapshot(function(e){var t=[];e.forEach(function(e){t.push(e.data());var n=[e.data().position.geopoint.latitude,e.data().position.geopoint.longitude];Z.a.circle(n,{color:"red",fillColor:"#f03",fillOpacity:.5,radius:10}).addTo(B).bindPopup(e.data().name).openPopup();e.ref.id===a.props.user.UID&&(Z.a.circle(n,{color:"black",fillColor:"#f03",fillOpacity:.5,radius:10}).addTo(B).bindPopup(e.data().name).openPopup(),B.setView(n,19))}),a.setState({players:t})})},a.getMatch=function(){p.collection("matches").doc(a.props.matchId).onSnapshot(function(e){e.data().admin.id===a.props.user.UID&&a.setState({admin:e.data().admin}),e.data().initialising&&a.setState({initialising:!0}),e.data().playing&&a.setState({playing:!0})})},a.initMap=function(){B=Z.a.map("map",{zoom:22,maxZoomLevel:22,maxNativeZoom:22,zoomControl:!0}).fitWorld().setView([a.state.boundary.lat,a.state.boundary.lng],19),Z.a.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{detectRetina:!0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(B);Z.a.circle([a.state.boundary.lat,a.state.boundary.lng],{color:"blue",fillColor:"#f03",fillOpacity:.5,radius:200}).addTo(B);var e=!1;B.on("locationfound",function(t){var n=d.point(t.latlng.lat,t.latlng.lng);p.collection(a.props.matchId).doc(a.props.user.UID).update({position:n.data}).then(function(){!1===e&&(a.getPlayers(),e=!0)})}),B.locate({setView:!0,maxZoom:19,watch:!0})},a.playGame=function(){p.collection("matches").doc(a.props.matchId).update({initialising:!0}).catch(function(e){return console.log("Error initialising game. ".concat(e))})},a.handleSonar=function(){},a}return Object(U.a)(t,e),Object(P.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props&&(this.initMap(),d.collection(this.props.matchId).setDoc(this.props.user.UID,{name:this.props.user.username}).then(function(){e.getMatch()}).catch(function(e){return alert("Error adding player to db",e)}))}},{key:"render",value:function(){var e=this.state,t=e.admin,a=e.initialising,n=e.players,o=e.playing;return r.a.createElement(A.a,{align:"center"},r.a.createElement(A.a,{id:"map",style:{height:"480px",width:"100%"}}),r.a.createElement(A.a,{width:"medium",align:"center"},n&&!a&&r.a.createElement("h3",null,n.length," players in game")),t&&!a&&r.a.createElement(z.a,{onClick:this.playGame,label:"Play!",primary:!0}),a&&"show timer here 30 seconds",o&&r.a.createElement(z.a,{primary:!0,style:{padding:"0.8em"},onClick:this.handleSonar}," send sonar "))}}]),t}(n.Component),K=Object(O.b)(function(e){return{user:e.user}})(F),Q=function(){return r.a.createElement(w.a,{theme:S.a},r.a.createElement(C.a,null,r.a.createElement(I.d,null,r.a.createElement(I.b,{path:"/signUp",exact:!0,component:G}),r.a.createElement(I.b,{path:"/login",exact:!0,component:W}),r.a.createElement(I.b,{path:"/profile",exact:!0,component:H}),r.a.createElement(I.b,{path:"/lobby",exact:!0,component:V}),r.a.createElement(I.b,{path:"/game/:matchId",exact:!0,render:function(e){return r.a.createElement(K,{matchId:e.match.params.matchId})}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.d,Y=Object(c.e)(v,q(Object(c.a)(i.a)));document.addEventListener("DOMContentLoaded",function(){Object(o.render)(r.a.createElement(O.a,{store:Y},r.a.createElement(Q,null)),document.getElementById("root"))}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},86:function(e,t,a){e.exports=a(110)}},[[86,1,2]]]);
//# sourceMappingURL=main.55b22eb4.chunk.js.map