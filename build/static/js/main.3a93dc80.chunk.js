(window["webpackJsonpsonar-app"]=window["webpackJsonpsonar-app"]||[]).push([[0],{113:function(e,t,a){},125:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(25),i=a(14),c=a(21),l=a(80),s=a(81),u=a(71),d=a(82),m=a.n(d),g=a(30),p=a(19),h=(a(108),a(110),a(83));p.initializeApp({apiKey:"AIzaSyBbTgM4qYDd9FxzKLZATux-i4Cz1tMoUb8",authDomain:"sonar-a3366.firebaseapp.com",databaseURL:"https://sonar-a3366.firebaseio.com",projectId:"sonar-a3366",storageBucket:"sonar-a3366.appspot.com",messagingSenderId:"591806355157",appId:"1:591806355157:web:34c9c60179e68488"});var f=p.auth(),y=p.firestore(),E=new h.GeoFirestore(y);function b(e){return E.collection("matches").doc(e)}function v(e){return y.collection("finishedMatches").doc(e)}function w(e,t){return E.collection("matches").doc(e).collection("players").doc(t)}function I(e){return E.collection("matches").doc(e).collection("players")}function O(e){return E.collection("matches").doc(e).collection("sonardPlayers")}function S(e){return E.collection("matches").doc(e).collection("taggedPlayers")}var j="GET_USER",P="GET_USER_INFO",k="REMOVE_USER";function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(a,!0).forEach(function(t){Object(g.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var D=Object(c.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case j:return C({UID:n},e);case P:return C({},e,{},n);case k:return null;default:return e}}}),U={key:"root",storage:m.a},L=Object(u.a)(U,D),M=Object(c.createStore)(L,Object(s.composeWithDevTools)(Object(c.applyMiddleware)(l.a))),x=Object(u.b)(M),z=a(84),G=(a(113),a(143)),q=a(91),A=a.n(q),F=a(18),W=a(32),B=a(9),R=a(10),J=a(12),Q=a(11),_=a(13),H=a(148),N=a(136),V=a(145),Y=a(144),Z=a(128),K=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={username:"",email:"",password:""},a.handleChange=function(e){a.setState(Object(g.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){e.preventDefault(),a.props.dispatch(function(e){var t=e.username,a=e.email,n=e.password;return function(e){return f.createUserWithEmailAndPassword(a,n).then(function(e){var a=e.user;return null!==a&&y.collection("users").doc(a.uid).set({username:t}).then(function(){console.log("user account created")}).catch(function(e){console.error("Error creating account: ",e)}),a}).then(function(t){e({type:j,payload:t.uid})}).catch(function(e){return console.log(e)})}}(a.state))},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password,n=e.username;return null!==this.props.authed?r.a.createElement(W.a,{to:"/profile"}):r.a.createElement(H.a,{align:"center",pad:"large"},r.a.createElement("h2",null,"Welcome to sonar"),r.a.createElement(H.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large"},r.a.createElement(N.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(V.a,null,r.a.createElement(Y.a,{placeholder:"email",name:"email",onChange:this.handleChange,value:t})),r.a.createElement(V.a,{required:!0},r.a.createElement(Y.a,{placeholder:"user name",name:"username",value:n,onChange:this.handleChange})),r.a.createElement(V.a,null,r.a.createElement(Y.a,{placeholder:"password",type:"password",name:"password",onChange:this.handleChange,value:a})),r.a.createElement(H.a,{direction:"row",justify:"center",margin:{top:"large"}},r.a.createElement(Z.a,{type:"submit",primary:!0,label:"Sign up"}))),r.a.createElement(H.a,{direction:"row",justify:"center"},r.a.createElement("p",null,"Already have an account? ",r.a.createElement(F.b,{to:"/login"},"Login here")))))}}]),t}(n.Component),$=Object(i.b)(function(e){return{authed:e.user}})(K),X=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:""},a.handleChange=function(e){a.setState(Object(g.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){var t;e.preventDefault(),a.props.dispatch((t=a.state,function(e){return f.signInWithEmailAndPassword(t.email,t.password).then(function(t){var a=t.user;e({type:j,payload:a.uid})}).catch(function(e){return console.log(e)})}))},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this.state,t=e.email,a=e.password;return null!==this.props.user?r.a.createElement(W.a,{to:"/profile"}):r.a.createElement(H.a,{align:"center",pad:"large"},r.a.createElement("h2",null,"Welcome to sonar"),r.a.createElement(H.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large"},r.a.createElement(N.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(V.a,null,r.a.createElement(Y.a,{placeholder:"email",name:"email",onChange:this.handleChange,value:t})),r.a.createElement(V.a,null,r.a.createElement(Y.a,{placeholder:"password",type:"password",name:"password",onChange:this.handleChange,value:a})),r.a.createElement(H.a,{direction:"row",justify:"center",margin:{top:"large"}},r.a.createElement(Z.a,{type:"submit",primary:!0,label:"Login"}))),r.a.createElement(H.a,{direction:"row",justify:"center"},r.a.createElement("p",null,"Dont have an account yet? ",r.a.createElement(F.b,{to:"/SignUp"},"Sign Up here")))))}}]),t}(n.Component),ee=Object(i.b)(function(e){return{user:e.user}})(X),te=a(138),ae={LOGIN:"/login",SIGN_UP:"/signUp",PROFILE:"/profile",LOBBY:"/lobby",GAME:"/game/:matchId",CLASS_SELECT:"/game/:matchId/class-select",FINISHED_GAME:"/game/:matchId/finished",HOME:"/"},ne=a(146),re=function(e){function t(){return Object(B.a)(this,t),Object(J.a)(this,Object(Q.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",{style:{textAlign:"center"}}," How to play"),r.a.createElement(H.a,{pad:"large",border:{color:"brand",size:"large"},align:"start",round:"large",elevation:"medium",gap:"small"},r.a.createElement(ne.a,{size:"small"},"Its hide and go seek tag. "),r.a.createElement(ne.a,{size:"small"},"Someone will be randomly chosen as the tagger "),r.a.createElement(ne.a,{size:"small"},"When you are tagged, you become a tagger 0.o "),r.a.createElement(ne.a,{size:"small"},"Last person to get tagged wins!")),r.a.createElement(H.a,{direction:"row",align:"start",gap:"small",justify:"between",style:{paddingBottom:"1em"}},r.a.createElement("div",null,r.a.createElement("h1",{style:{textAlign:"center"}},"Tagger"),r.a.createElement(H.a,{border:{color:"brand",size:"large"},pad:"small",round:!0},r.a.createElement(ne.a,{size:"small"},"Tag anyone within 2m of you."),r.a.createElement(ne.a,{size:"small"},"Watch the map for player sonars"))),r.a.createElement("div",null,r.a.createElement("h1",{style:{textAlign:"center"}},"Player"),r.a.createElement(H.a,{border:{color:"brand",size:"large"},pad:"small",align:"center",round:!0},r.a.createElement(ne.a,{size:"small"},"Send a sonar to see where the taggers are! But..."),r.a.createElement(ne.a,{size:"small"},"..They will also see your position too")))))}}]),t}(n.Component),oe=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={redirect:!1},a.logout=function(){a.props.dispatch(function(e){f.signOut().then(function(){e({type:k})}).catch(function(e){console.log(e)})})},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e;this.props.user.UID?this.props.dispatch((e=this.props.user.UID,function(t){y.collection("users").doc(e).get().then(function(e){e.exists?t({type:P,payload:e.data()}):console.log("user not found")}).catch(function(e){console.log("Error getting user:",e)})})):this.setState({redirect:!0})}},{key:"render",value:function(){return this.props.user?r.a.createElement(H.a,{justify:"center",align:"center",style:{paddingLeft:"1em",paddingRight:"1em"}},r.a.createElement("h2",null," ","".concat(this.props.user.username)," "),this.props.user.wins&&r.a.createElement("p",null,"games won: ",this.props.user.wins),!this.props.user.wins&&r.a.createElement("p",null,"go win some games!"),r.a.createElement(Z.a,{as:F.b,to:"/lobby",primary:!0,label:"play"}),r.a.createElement(H.a,{justify:"center",align:"center",direction:"row",style:{paddingLeft:"1em",paddingRight:"1em"}},r.a.createElement(te.a,{style:{margin:"1em"},label:"Rules",dropAlign:{top:"top",right:"right"},dropContent:r.a.createElement(re,null)}),r.a.createElement(Z.a,{secondary:!0,onClick:this.logout,label:"logout"}))):r.a.createElement(W.a,{to:ae.HOME})}}]),t}(n.Component),ie=Object(i.b)(function(e){return{user:e.user}})(oe),ce=null,le=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={password:"",redirect:!1,matches:!1,matchId:!1},a.getMatches=function(e,t){var n=E.collection("matches").near({center:new p.firestore.GeoPoint(t.coords.latitude,t.coords.longitude),radius:1});ce=n.onSnapshot(function(t){var n=[];t.forEach(function(t){var r=[];E.collection("matches").doc(t.id).collection("players").get().then(function(n){n.forEach(function(n){n.data().id===e&&a.setState({matchId:t.id}),r.push(n.data())})}),t.data().playing||n.push({matchId:t.id,admin:t.data().admin,players:r})}),console.log("matches within 1km ",n),a.setState({matches:n})})},a.createMatch=function(e,t){E.collection("matches").add({admin:{id:e,name:t},password:a.state.password,waiting:!0,playing:!1,initialising:!1,coordinates:new p.firestore.GeoPoint(a.state.position.coords.latitude,a.state.position.coords.longitude)}).then(function(n){E.collection("matches").doc(n.id).collection("players").doc(a.props.user.UID).set({id:e,name:t,sonar:!1,coordinates:new p.firestore.GeoPoint(a.state.position.coords.latitude,a.state.position.coords.longitude)}).then(function(){return a.setState({matchId:n.id})}).catch(function(e){return console.log("Error adding ".concat(t," to match. ").concat(e))})}).catch(function(e){return console.error("Error setting ".concat(t," as admin of match. ").concat(e))})},a.joinMatch=function(e,t,n){E.collection("matches").doc(e).collection("players").doc(a.props.user.UID).set({id:t,name:n,sonar:!1,coordinates:new p.firestore.GeoPoint(0,0)}).then(function(){return a.setState({matchId:e})}).catch(function(e){return console.log("Error joining match. ".concat(e))})},a.handleInput=function(e){return a.setState(Object(g.a)({},e.target.name,e.target.value))},a.handleSubmit=function(e){e.preventDefault(),a.createMatch(a.props.user.UID,a.props.user.username)},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){console.log("got position",t),e.props.user.UID&&t&&(e.setState({position:t}),e.getMatches(e.props.user.UID,t))})}},{key:"componentWillUnmount",value:function(){ce&&ce(),ce=null}},{key:"render",value:function(){var e=this,t=this.props.user,a=t.UID,n=t.username,o=this.state,i=o.matches,c=o.matchId;return c?r.a.createElement(W.a,{to:"game/".concat(c)}):r.a.createElement(H.a,{direction:"column",justify:"center",align:"center",pad:"small",gap:"medium"},this.state.position&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Create a game"),r.a.createElement(H.a,{pad:"medium",border:{color:"brand",size:"large"},elevation:"medium",round:"large",width:"medium",align:"center"},r.a.createElement(N.a,{style:{margin:"1.5em 1.5em 0 1.5em "},onSubmit:this.handleSubmit},r.a.createElement(V.a,{type:"password",name:"password",label:"password",onChange:this.handleInput}),r.a.createElement(Z.a,{type:"submit",primary:!0,label:"Create game"}))),r.a.createElement(H.a,{width:"medium",align:"center"},i.length>=1?r.a.createElement("h1",null,"Join a game"):r.a.createElement("p",null,"No other games within 1km"),i&&i.map(function(t){return r.a.createElement(H.a,{key:t.matchId,pad:"small",border:{color:"primary",size:"large"},elevation:"small",round:"large",width:"medium",align:"center",direction:"row-responsive",style:{marginTop:"1.5em"}},r.a.createElement("h3",{style:{margin:"auto"}},"created by "+t.admin.name," ",r.a.createElement("br",null)),r.a.createElement(Z.a,{onClick:function(){return e.joinMatch(t.matchId,a,n)},primary:!0,label:"Join"}))}))))}}]),t}(n.Component),se=Object(i.b)(function(e){return{user:e.user}})(le),ue=a(139),de=a(140),me=a(24),ge=a.n(me),pe=(a(118),a(147)),he=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){a.props.timer&&setTimeout(function(){a.props.clear()},3e3)},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(H.a,{direction:"row",justify:"center",style:{width:"80vw",height:"100%"}},r.a.createElement(pe.a,{level:3,size:"medium"},this.props.message),r.a.createElement(Z.a,{hoverIndicator:"light-1",onClick:function(){return e.props.clear()}},r.a.createElement(H.a,{pad:"small",direction:"row",align:"center",gap:"small"},r.a.createElement(ue.a,null))))}}]),t}(n.Component),fe=null,ye=null,Ee=null,be=null,ve=null,we=null,Ie=null,Oe=[],Se=null,je=null,Pe=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={boundary:null,position:null,zoom:18,admin:!1,initialising:!1,players:null,userLocationFound:!1,sonarTimer:0,playing:!1,initialisingTimer:60,geolocationError:!1,waiting:!1,tagger:!1,imTagger:!1,allPlayersTagged:!1,finished:!1,gameTimer:!1,abilityUsage:0,abilityTimer:0,quirk:!1,abilityInUse:!1,snitchingOn:[],remaining:[]},a.startTimer=function(e){var t,n,r=e;je=setInterval(function(){t=parseInt(r/60,10),n=parseInt(r%60,10),t=t<10?"0"+t:t,n=n<10?"0"+n:n,0===r&&(clearInterval(je),a.state.admin&&a.getSurvivors());var e=t+":"+n;a.setState({gameTimer:e}),--r},1e3)},a.startInitialiseTimer=function(){var e=5;Se=setInterval(function(){e-=1,a.setState({initialisingTimer:e}),0===e&&(a.setState({initialisingTimer:0}),b(a.props.matchId).update({initialising:!1,playing:!0}).catch(function(e){return console.log("Error initialising game. ".concat(e))}))},1e3)},a.initMap=function(){fe=ge.a.map("map",{zoom:22,maxZoomLevel:22,maxNativeZoom:22,zoomControl:!0}).fitWorld(),ge.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{detectRetina:!0,attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(fe),fe.on("locationfound",function(e){a.setState({myPosition:e.latlng});var t=new p.firestore.GeoPoint(e.latlng.lat,e.latlng.lng);if(null===ye&&null!==fe)ye=ge.a.circle(e.latlng,{color:"black",fillColor:"#f03",fillOpacity:.5,radius:5}).addTo(fe).bindPopup(a.props.user.username).openPopup(),fe.setView(e.latlng,17);else if(ye){var n=new ge.a.LatLng(e.latlng.lat,e.latlng.lng);ye.setLatLng(n)}null===Ee&&null!==fe&&a.state.admin&&(console.log("setting default boundary pos"),Ee=ge.a.circle(e.latlng,{color:"blue",fillColor:"#f03",fillOpacity:.3,radius:100}).addTo(fe),a.setState({boundary:e.latlng}),fe.setView(e.latlng,17),a.adminSetBoundary()),w(a.props.matchId,a.props.user.UID).update({coordinates:t}).catch(function(e){return console.log("error watching user position",e)})}),fe.on("locationerror",function(e){alert("Please enable geolocation access to play game. \n      redirecting in 2 seconds"),setTimeout(function(){a.setState({geolocationError:!0})},2500)}),fe.locate({maxZoom:22,watch:!0,enableHighAccuracy:!0})},a.leaveGame=function(){},a.handlePlayerQuit=function(){console.log("quitting",a.state.remaining),a.state.waiting?a.state.admin?a.quitGame():w(a.props.matchId,a.props.user.UID).delete().then(function(){a.setState({quit:!0}),console.log("succesfully left game")}).catch(function(e){return console.log("error removing player from match ")}):a.state.imTagger?a.state.imTagger&&I(a.props.matchId).get().then(function(e){var t=[];return e.forEach(function(e){t.push(e.data())}),t}).then(function(e){if(e.find(function(e){return e.tagger})){var t=e.filter(function(e){return e.id!==a.props.user.UID});t.length>1?a.setDraw(t):a.setWinner(t[0])}else w(a.props.matchId,a.props.user.UID).delete().then(function(){a.setState({quit:!0}),console.log("succesfully left game"),b(a.props.matchId).update({quitter:a.props.user.username}).then(function(){console.log("updated game that ".concat(a.props.user.username," has quit"))}).catch(function(e){return console.log("error updating game that ".concat(a.props.user.username," has quit"))})}).catch(function(e){return console.log("error removing player from match ")})}).catch(function(e){return console.log("error getting playersRef ".concat(e))}):1===a.state.remaining?a.setWinner({name:a.props.user.username,id:a.props.user.UID}):a.state.remaining>1&&w(a.props.matchId,a.props.user.UID).delete().then(function(){a.setState({quit:!0}),console.log("succesfully left game"),b(a.props.matchId).update({quitter:a.props.user.username,remaining:a.state.remaining-1}).then(function(){console.log("updated game that ".concat(a.props.user.username," has quit"))}).catch(function(e){return console.log("error updating game that ".concat(a.props.user.username," has quit"))})}).catch(function(e){return console.log("error removing player from match ")})},a.putPlayersMarkersOnMap=function(e){var t=[];e.forEach(function(e){var a=[e.position.geopoint.latitude,e.position.geopoint.longitude],n=ge.a.circle(a,{color:"red",fillColor:"green",fillOpacity:.5,radius:5}).addTo(fe).bindPopup("you've tagged ".concat(e.name)).openPopup();t.push(n)});var a=3,n=setInterval(function(){0===(a-=1)&&(t.forEach(function(e){fe.removeLayer(e)}),clearInterval(n))},1e3)},a.getMatch=function(){be=b(a.props.matchId).onSnapshot(function(e){e.exists&&(a.setState({gotMatch:!0}),e.data().admin.id===a.props.user.UID&&a.setState({admin:e.data().admin}),!0===e.data().waiting?(a.setState({waiting:!0}),a.watchPlayersJoin()):!1===e.data().waiting&&a.setState({waiting:!1}),e.data().initialising?(a.setState({initialising:!0}),a.startInitialiseTimer(),a.removeJoinedPlayers(),e.data().boundary&&a.setBoundary(e.data().boundary)):!1===e.data().initialising&&a.setState({initialising:!1}),e.data().playing?(clearInterval(Se),a.setState({playing:!0}),a.watchForTaggedPlayers(),a.watchForPlayerSonars(),Ie&&Ie(),Ie=null,fe&&null===a.state.boundary&&e.data().boundary&&a.setBoundary(e.data().boundary),e.data().remaining&&console.log("remaining players",e.data().remaining),e.data().remaining&&a.setState({remaining:e.data().remaining})):!1===e.data().playing&&a.setState({playing:!1}),e.data().tagger&&(e.data().tagger.id===a.props.user.UID?a.setState({imTagger:!0,tagger:e.data().tagger}):a.setState({tagger:e.data().tagger})),e.data().finished&&(clearInterval(je),a.state.admin&&a.deleteMatch(),fe&&fe.stopLocate(),a.setState({finished:!0})),e.data().quit&&(clearInterval(je),a.state.admin&&a.deleteMatch(),a.setState({quit:!0})),e.data().quitter&&(console.log("we got a quitter",e.data().quitter),a.setState({quitter:e.data().quitter}),e.data().quitter===e.data().tagger.name&&a.state.taggerHasTaggedSomeone&&(console.log("setting draw.."),a.setDraw())),console.log("match data",e.data()))})},a.adminSetBoundary=function(){console.log("setting boundary");var e=!1;Ee.on({mousedown:function(){fe.removeEventListener("mousedown"),console.log("mousedown"),(e=!e)?fe.on("mousemove",function(e){Ee.setLatLng(e.latlng),a.setState({boundary:e.latlng})}):fe.removeEventListener("mousemove")}})},a.setBoundary=function(e){a.setState({boundary:e}),console.log("setting boundary from db",e),Ee&&fe.removeLayer(Ee),Ee=ge.a.circle(e,{color:"blue",fillColor:"#f03",fillOpacity:.3,radius:100}).addTo(fe),fe.setView(e,17)},a.watchPlayersJoin=function(){Ie=I(a.props.matchId).onSnapshot(function(e){if(a.state.admin){var t=e.size;console.log("player joined, total = ",t),t>1&&a.setState({playersJoined:t,showPlayBtn:!0})}e.forEach(function(e){if(e.data().id!==a.props.user.UID){var t=e.data(),n=Oe.find(function(e){return e.id===t.id});console.log("alreadyOnMap",n);var r=[t.coordinates._lat,t.coordinates._long];if(console.log("player",t),console.log(r),n)n.marker.setLatLng(r);else{console.log("setting joined player marker");var o=ge.a.circle(r,{color:"red",fillColor:"green",fillOpacity:.5,radius:5}).addTo(fe).bindPopup("".concat(t.name)).openPopup();Oe.push({id:t.id,marker:o})}}})}),a.state.playing&&(Ie&&Ie(),Ie=null)},a.removeJoinedPlayers=function(){Oe.forEach(function(e){return fe.removeLayer(e.marker)})},a.deleteMatch=function(){b(a.props.matchId).delete().then(function(){console.log("game successfully deleted!")}).catch(function(e){console.error("Error removing match from db: ",e)})},a.initGame=function(){b(a.props.matchId).get().then(function(e){e.exists&&b(a.props.matchId).update({boundary:[a.state.boundary.lat,a.state.boundary.lng]}).then(function(){return console.log("set boundary position in db")}).catch(function(e){return console.log("error setting boundary position in db ".concat(e))})});var e=[];I(a.props.matchId).get().then(function(t){t.forEach(function(t){e.push({id:t.data().id,name:t.data().name})})}).then(function(){var t=e[Math.floor(Math.random()*e.length)],n=e.length-1;b(a.props.matchId).update({initialising:!0,waiting:!1,tagger:t,remaining:n}).catch(function(e){return console.log("Error choosing tagger. ".concat(e))}),I(a.props.matchId).doc(t.id).update({tagger:!0}).then(function(){return console.log(" set tagger. ".concat(t.name))}).catch(function(e){return console.log("Error choosing tagger. ".concat(e))})})},a.tagPlayer=function(){var e=new p.firestore.GeoPoint(a.state.myPosition.lat,a.state.myPosition.lng);I(a.props.matchId).near({center:e,radius:.025}).get().then(function(e){var t=[];e.docs.forEach(function(e){e.exists&&t.push(e.data())}),console.log("geoQuery ",t);var n=t.filter(function(e){return!e.tagger});if(console.log("not tagged query",n),a.setState({tagFail:!1}),0===n.length&&a.setState({tagFail:!0}),a.state.remaining===n.length)n.length>1?a.setDraw(n):a.setWinner(n[0]);else{a.setPlayersAsTagged(n);var r=a.state.remaining-n.length;b(a.props.matchId).update({remaining:r}).then(console.log("update: remaining players = ".concat(r))).catch(function(e){return console.log("error updating remaining players in match doc ".concat(e))})}})},a.setPlayersAsTagged=function(e){a.setState({iJustTagged:e}),e.forEach(function(e){w(a.props.matchId,e.id).update({tagger:!0,sonar:!1}).then(console.log("updated ".concat(e.name," doc to tagger: true"))).catch(function(e){return console.log("error updating player to tagger ".concat(e))}),w(a.props.matchId,e.id).get().then(function(e){var t;return e.exists&&(t=[e.data().coordinates.latitude,e.data().coordinates.longitude]),t}).then(function(t){t&&S(a.props.matchId).doc(e.id).set({name:e.name,id:e.id,coordinates:new p.firestore.GeoPoint(t[0],t[1])}).then(function(){return console.log("added ".concat(e.name," to tagged players doc"))}).catch(function(t){return console.log("error adding ".concat(e.name," to tagged players doc ").concat(t))})}).catch(function(t){return console.log("error getting ".concat(e.name,"'s position ").concat(t))})})},a.setDraw=function(e){console.log("set draw",e),v(a.props.matchId).set({draw:e}).then(function(){return console.log("match drew, winners are: ",e)}).then(function(){return a.endGame()}).catch(function(e){return console.log("error when setting match draw ".concat(e))})},a.setWinner=function(e){v(a.props.matchId).set({winner:e}).then(function(){return console.log("set winner ".concat(e.name))}).then(function(){return a.endGame()}).catch(function(e){console.log("Error setting winner",e)})},a.watchForTaggedPlayers=function(){we=S(a.props.matchId).onSnapshot(function(e){e.docChanges().forEach(function(e){if("added"===e.type){a.setState({taggerHasTaggedSomeone:!0});var t=e.doc.data();a.setTaggedPlayerMarker(t),t.id===a.props.user.UID&&a.setState({imTagger:!0,iGotTagged:!0})}e.type,"removed"===e.type&&console.log("removed",e.doc.data())})})},a.setTaggedPlayerMarker=function(e){console.log(e.name+"was tagged");var t=[e.coordinates.latitude,e.coordinates.longitude],n=ge.a.circle(t,{color:"orange",fillColor:"orange",fillOpacity:.5,radius:2.5}).addTo(fe).bindPopup("".concat(e.name," was tagged")).openPopup();setTimeout(function(){!a.state.finished&&n&&(console.log("removing just tagged player marker"),fe.removeLayer(n),fe.setView(a.state.boundary,17))},5e3)},a.sendSonar=function(){a.setState({sentSonar:!0}),I(a.props.matchId).where("tagger","==",!0).get().then(function(e){console.log("got taggers"),e.forEach(function(e){var t=[e.data().coordinates.latitude,e.data().coordinates.longitude];console.log("tagger pos",t);var n=ge.a.circle(t,{color:"green",fillColor:"green",fillOpacity:.5,radius:2.5}).addTo(fe).bindPopup("Tagger").openPopup();fe.setView(a.state.boundary,17),setTimeout(function(){!a.state.finished&&n&&fe.removeLayer(n)},5e3)})}).then(function(){w(a.props.matchId,a.props.user.UID).get().then(function(e){var t=[e.data().coordinates.latitude,e.data().coordinates.longitude];return console.log("got ".concat(a.props.user.username,"'s position. ").concat(t)),t}).then(function(e){e&&O(a.props.matchId).doc(a.props.user.UID).set({name:a.props.user.username,id:a.props.user.UID,coordinates:new p.firestore.GeoPoint(e[0],e[1])}).then(function(){console.log("added player to sonard players coll"),O(a.props.matchId).doc(a.props.user.UID).delete().then(function(){return console.log("removed player from sonard coll")}).catch(function(e){return console.log("error deleting player from sonard coll ".concat(e))})}).catch(function(e){return console.log("error adding player to sonard players coll ".concat(e))})}).catch(function(e){return console.log("error getting ".concat(a.props.user.UID,"'s position"))})})},a.watchForPlayerSonars=function(){we=O(a.props.matchId).onSnapshot(function(e){e.docChanges().forEach(function(e){if("added"===e.type){var t=e.doc.data();a.checkForPlayersSonar(t)}e.type,e.type})})},a.checkForPlayersSonar=function(e){if(a.state.imTagger){console.log(e.name+"used sonar");var t=[e.coordinates.latitude,e.coordinates.longitude],n=ge.a.circle(t,{color:"green",fillColor:"green",fillOpacity:.5,radius:2.5}).addTo(fe).bindPopup("player used sonar").openPopup();console.log("set just sonard player marker"),setTimeout(function(){!a.state.finished&&n&&(console.log("removing just sonard player marker"),fe.removeLayer(n),a.state.boundary&&fe.setView(a.state.boundary,19))},5e3)}},a.endGame=function(){b(a.props.matchId).get().then(function(e){console.log("ending game"),e.exists&&b(a.props.matchId).update({initialising:!1,waiting:!1,playing:!1,finished:!0}).then(function(){return console.log("game finished")}).catch(function(e){console.log("Error ending game",e)})})},a.quitGame=function(){b(a.props.matchId).update({quit:!0}).then(function(){return console.log("admin quit game")}).catch(function(e){console.log("Error quiting game",e)})},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("beforeunload",function(){setTimeout(function(){console.log("player hasnt been active for more then 10 seconds => removed from game"),e.handlePlayerQuit()},1e4)}),this.props&&(b(this.props.matchId).get().then(function(t){t.exists&&t.data().admin.id===e.props.user.UID&&(console.log("player is set as admin"),e.setState({admin:!0}))}).then(function(){e.initMap()}),this.getMatch())}},{key:"componentWillUnmount",value:function(){ve&&ve(),we&&we(),be&&be(),Ie&&Ie(),Ee&&fe.removeLayer(Ee),fe&&fe.stopLocate(),fe=null,Ee=null,ye=null,be=null,ve=null,we=null,Ie=null,Se=null,je=null,window.removeEventListener("beforeunload",this.handlePlayerQuit)}},{key:"render",value:function(){var e=this,t=this.state,a=t.gameTimer,n=t.finished,o=t.tagger,i=t.imTagger,c=t.waiting,l=t.initialising,s=t.admin,u=t.geolocationError,d=t.playing,m=t.initialisingTimer,g=t.remaining,p=t.quit,h=t.showPlayBtn,f=t.quitter,y=t.showQuitOverlay,E=t.iGotTagged,b=t.iJustTagged,v=t.tagFail,w=t.sentSonar;return u?r.a.createElement(W.a,{to:ae.PROFILE}):n?r.a.createElement(W.a,{to:"".concat(this.props.matchId,"/finished")}):p?r.a.createElement(W.a,{to:ae.HOME}):r.a.createElement(H.a,{align:"center"},y&&r.a.createElement("div",null,r.a.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:3,backgroundColor:"grey",opacity:.7}}),r.a.createElement(H.a,{pad:"medium",background:"light-2",style:{height:"25vh",width:"60vw",position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:3}},r.a.createElement("p",{style:{textAlign:"center"}},"Are you sure you want to quit?"),r.a.createElement(H.a,{style:{position:"relative",zIndex:4},direction:"row",align:"center",justify:"between"},r.a.createElement(Z.a,{hoverIndicator:!0,primary:!0,label:"Back",onClick:function(){return e.setState({showQuitOverlay:!1})}}),r.a.createElement(Z.a,{hoverIndicator:!0,secondary:!0,label:"Quit",onClick:this.handlePlayerQuit})))),r.a.createElement(H.a,{style:{position:"fixed",top:"0.5em",right:"0.5em",zIndex:2}},r.a.createElement(H.a,{elevation:"small",round:"full",overflow:"hidden",background:"light-2"},r.a.createElement(Z.a,{icon:r.a.createElement(ue.a,null),hoverIndicator:!0,onClick:function(){return e.setState({showQuitOverlay:!0})}})),r.a.createElement(H.a,{style:{marginTop:"0.5em"},elevation:"small",round:"full",overflow:"hidden",background:"light-2"},r.a.createElement(te.a,{icon:r.a.createElement(de.a,null),dropAlign:{top:"bottom",left:"left"},dropContent:r.a.createElement(re,null)}))),r.a.createElement(H.a,{id:"map",style:{height:"60vh",width:"100%",zIndex:1}}),d&&r.a.createElement("div",null,r.a.createElement("p",{style:{color:"red"}},a)),s&&c&&r.a.createElement("div",null,r.a.createElement("p",null,"tap boundary to move and place it"),h?r.a.createElement("p",null,"Press play when all players have joined game."):r.a.createElement("p",{style:{marginRight:"2em"}},"no players joined yet.."),r.a.createElement(H.a,{align:"center",direction:"row"},h&&r.a.createElement(Z.a,{onClick:this.initGame,label:"Play!",primary:!0}),r.a.createElement(Z.a,{onClick:this.quitGame,label:"Quit",secondary:!0}))),!s&&c&&r.a.createElement("p",null,"waiting for more players to join..."),l&&!i&&r.a.createElement("div",null,r.a.createElement("h2",null,"".concat(o.name," is in!")),r.a.createElement("p",null,"Game starts in ".concat(m," seconds. GO HIDE!!!"))),l&&i&&r.a.createElement("p",null,"Your in! ",r.a.createElement("br",null),"you may hunt players in ".concat(m," seconds")),!i&&d&&(w?r.a.createElement(he,{message:"Sonar sent. Tagger's can see your position! ",timer:!0,clear:function(){return e.setState({sentSonar:null})}}):r.a.createElement(Z.a,{primary:!0,style:{padding:"0.8em"},onClick:this.sendSonar,label:"send sonar"})),i&&d&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Z.a,{primary:!0,style:{padding:"0.8em"},onClick:this.tagPlayer,label:"tag"})),f&&r.a.createElement(he,{message:"".concat(f," has quit!"),timer:!0,clear:function(){return e.setState({quitter:null})}}),E&&r.a.createElement(he,{message:"you got tagged! you are now a tagger",clear:function(){return e.setState({iGotTagged:null})}}),b&&b.map(function(t){return r.a.createElement(he,{key:t.id,message:"you tagged ".concat(t.name),clear:function(){return e.setState({iJustTagged:null})}})}),v&&r.a.createElement(he,{message:"no players within 2m. tagging unsuccessfull",timer:!0,clear:function(){return e.setState({tagFail:null})}}),i&&d&&(1===g?r.a.createElement("p",null," ",g," player left! "):r.a.createElement("p",null," ",g," player's left ")))}}]),t}(n.Component),ke=Object(i.b)(function(e){return{user:e.user}})(Pe),Te=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={},a.componentDidMount=function(){a.getWinners()},a.getWinners=function(){y.collection("finishedMatches").doc(a.props.matchId).get().then(function(e){if(e.exists)if(e.data().winner)a.setState({winner:e.data().winner}),e.data().winner.id===a.props.user.UID&&a.updateWinTotal();else if(e.data().draw){console.log(e.data().draw),a.setState({draw:e.data().draw}),e.data().draw.find(function(e){return e.id===a.props.user.UID})&&a.updateWinTotal()}})},a.updateWinTotal=function(){var e=0;y.collection("users").doc(a.props.user.UID).get().then(function(t){t.data().wins&&(e=t.data().wins)}).then(function(){y.collection("users").doc(a.props.user.UID).update({wins:e+1}).then(function(){console.log("updated user stats")}).catch(function(e){console.error("Error updating user stats ",e)})})},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this.state,t=e.winner,a=e.draw;return r.a.createElement(H.a,{align:"center"},r.a.createElement(H.a,{justify:"center",align:"center",pad:"medium"},t&&r.a.createElement(pe.a,null,t.name," won!"),a&&r.a.createElement(H.a,{direcrtion:"column",justify:"center",align:"center",pad:"medium"},r.a.createElement(pe.a,null,"Its a draw!"),a.map(function(e){return r.a.createElement(pe.a,{key:e.name},e.name," won")}))),r.a.createElement(H.a,{direction:"row"},r.a.createElement(Z.a,{as:F.b,to:ae.LOBBY,primary:!0,label:"play again"}),r.a.createElement(Z.a,{as:F.b,to:ae.PROFILE,secondary:!0,label:"go home"})))}}]),t}(n.Component),Ce=Object(i.b)(function(e){return{user:e.user}})(Te),De=a(141),Ue=a(142),Le=function(e){function t(){var e,a;Object(B.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(J.a)(this,(e=Object(Q.a)(t)).call.apply(e,[this].concat(r)))).state={redirect:!1,classes:[{name:"Joker",description:"Can give away a fake position for up to 90 seconds. can use it 2 times per game"},{name:"Snitch",description:"Can give other players position away to tagger 3 times per game"},{name:"Defuser",description:"Can cancel 5 sonars per game"}]},a.componentDidMount=function(){E.collection("matches").doc(a.props.matchId).collection("players").doc(a.props.user.UID).get().then(function(e){e.data().playerQuirk&&a.setState({redirect:!0})})},a.selectClass=function(e){var t={};"Defuser"===e?t={playerQuirk:e,abilityUse:5}:"Joker"===e?t={playerQuirk:e,abilityUse:2}:"Snitch"===e&&(t={playerQuirk:e,abilityUse:3}),E.collection("matches").doc(a.props.matchId).collection("players").doc(a.props.user.UID).update(t).then(function(){a.setState({redirect:!0}),console.log("updated user class")}).catch(function(e){return"error updating user class, ".concat(e)})},a}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){var e=this;return this.state.redirect?r.a.createElement(W.a,{to:"/game/".concat(this.props.matchId)}):r.a.createElement(H.a,{direction:"column",justify:"center",align:"center",pad:"xlarge",gap:"medium"},r.a.createElement(pe.a,null,"Choose your class"),r.a.createElement(H.a,{pad:"large",align:"center",background:"dark-2",round:!0,gap:"small"},r.a.createElement(De.a,{size:"large",color:"light-2"}),r.a.createElement(ne.a,null,"Tagger"),r.a.createElement(ne.a,{size:"small"},"Tag anyone within 5m of you. no mercy")),this.state.classes.map(function(t){return r.a.createElement(H.a,{pad:"large",align:"center",background:{color:"light-2",opacity:"strong"},round:!0,gap:"small",key:t.name},r.a.createElement(Ue.a,{size:"large"}),r.a.createElement(ne.a,null,t.name),r.a.createElement(ne.a,{size:"small"},t.description),r.a.createElement(Z.a,{onClick:function(){return e.selectClass(t.name)},primary:!0,label:"Select"}))}))}}]),t}(n.Component),Me=Object(i.b)(function(e){return{user:e.user}})(Le),xe=function(){return r.a.createElement(G.a,{theme:A.a},r.a.createElement(F.a,null,r.a.createElement(W.d,null,r.a.createElement(W.b,{path:ae.SIGN_UP,exact:!0,component:$}),r.a.createElement(W.b,{path:"/",exact:!0,component:$}),r.a.createElement(W.b,{path:ae.LOGIN,exact:!0,component:ee}),r.a.createElement(W.b,{path:ae.PROFILE,exact:!0,component:ie}),r.a.createElement(W.b,{path:ae.LOBBY,exact:!0,component:se}),r.a.createElement(W.b,{path:ae.GAME,exact:!0,render:function(e){return r.a.createElement(ke,{matchId:e.match.params.matchId})}}),r.a.createElement(W.b,{path:ae.CLASS_SELECT,exact:!0,render:function(e){return r.a.createElement(Me,{matchId:e.match.params.matchId})}}),r.a.createElement(W.b,{path:ae.FINISHED_GAME,exact:!0,render:function(e){return r.a.createElement(Ce,{matchId:e.match.params.matchId})}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(122).config(),document.addEventListener("DOMContentLoaded",function(){Object(o.render)(r.a.createElement(i.a,{store:M},r.a.createElement(z.PersistGate,{loading:null,persistor:x},r.a.createElement(xe,null))),document.getElementById("root"))}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},97:function(e,t,a){e.exports=a(125)}},[[97,1,2]]]);
//# sourceMappingURL=main.3a93dc80.chunk.js.map